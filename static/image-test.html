<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>图片路径测试</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 p-8">
    <div class="max-w-4xl mx-auto bg-white p-6 rounded-lg shadow">
        <h1 class="text-2xl font-bold mb-4">图片路径测试</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- 测试原始路径 -->
            <div class="border p-4 rounded">
                <h3 class="font-semibold mb-2">原始相对路径测试</h3>
                <p class="text-sm text-gray-600 mb-2">路径: _page_2_Figure_4.jpeg</p>
                <img src="/docs/74HC165D/_page_2_Figure_4.jpeg" 
                     alt="测试图片" 
                     class="max-w-full h-auto border rounded"
                     onerror="this.style.display='none'; this.nextElementSibling.style.display='block'">
                <div style="display:none" class="text-red-500 text-sm">❌ 图片加载失败</div>
            </div>

            <!-- 测试功能框图 -->
            <div class="border p-4 rounded">
                <h3 class="font-semibold mb-2">功能框图测试</h3>
                <p class="text-sm text-gray-600 mb-2">路径: _page_1_Figure_6.jpeg</p>
                <img src="/docs/74HC165D/_page_1_Figure_6.jpeg" 
                     alt="功能框图" 
                     class="max-w-full h-auto border rounded"
                     onerror="this.style.display='none'; this.nextElementSibling.style.display='block'">
                <div style="display:none" class="text-red-500 text-sm">❌ 图片加载失败</div>
            </div>

            <!-- 测试应用电路图 -->
            <div class="border p-4 rounded">
                <h3 class="font-semibold mb-2">应用电路图测试</h3>
                <p class="text-sm text-gray-600 mb-2">路径: _page_10_Figure_3.jpeg</p>
                <img src="/docs/74HC165D/_page_10_Figure_3.jpeg" 
                     alt="应用电路图" 
                     class="max-w-full h-auto border rounded"
                     onerror="this.style.display='none'; this.nextElementSibling.style.display='block'">
                <div style="display:none" class="text-red-500 text-sm">❌ 图片加载失败</div>
            </div>

            <!-- 测试封装图 -->
            <div class="border p-4 rounded">
                <h3 class="font-semibold mb-2">封装图测试</h3>
                <p class="text-sm text-gray-600 mb-2">路径: _page_12_Figure_4.jpeg</p>
                <img src="/docs/74HC165D/_page_12_Figure_4.jpeg" 
                     alt="封装图" 
                     class="max-w-full h-auto border rounded"
                     onerror="this.style.display='none'; this.nextElementSibling.style.display='block'">
                <div style="display:none" class="text-red-500 text-sm">❌ 图片加载失败</div>
            </div>
        </div>

        <div class="mt-6 p-4 bg-blue-50 rounded">
            <h3 class="font-semibold mb-2">Markdown 路径转换测试</h3>
            <button onclick="testMarkdownConversion()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                测试 Markdown 图片转换
            </button>
            <div id="markdown-result" class="mt-4"></div>
        </div>
    </div>

    <script>
        function testMarkdownConversion() {
            // 从你的实际 markdownToHtml 函数复制的图片处理部分
            const testMarkdown = `
这是引脚配置图：![](_page_2_Figure_4.jpeg)

功能框图如下：![](_page_1_Figure_6.jpeg)

应用电路：![](_page_10_Figure_3.jpeg)
            `;

            const result = testMarkdown.replace(/!\[\]\(([^)]+)\)/g, function(match, src) {
                // Handle relative paths - convert to absolute paths for web access
                let imageSrc = src;
                if (!src.startsWith('http') && !src.startsWith('/')) {
                    // For relative paths like "_page_2_Figure_4.jpeg", assume they're in docs/74HC165D/
                    if (src.startsWith('_page_')) {
                        imageSrc = `/docs/74HC165D/${src}`;
                    } else {
                        imageSrc = `/docs/${src}`;
                    }
                }
                const filename = src.split('/').pop() || src;
                return `<div class="my-6 text-center p-4 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300">
                    <img src="${imageSrc}" alt="参考图片" class="max-w-full h-auto mx-auto rounded-lg shadow-md border border-gray-200" style="max-height: 500px;" onerror="this.style.display='none'; this.nextElementSibling.style.display='block'"/>
                    <div style="display:none" class="text-red-500 text-sm mt-2 p-2 bg-red-50 rounded">
                        🖼️ 图片加载失败: ${imageSrc}
                        <br><span class="text-xs">请检查图片路径是否正确</span>
                    </div>
                    <p class="text-sm text-gray-600 mt-3 font-medium">📷 ${filename}</p>
                </div>`;
            });

            document.getElementById('markdown-result').innerHTML = result;
        }
    </script>
</body>
</html>
